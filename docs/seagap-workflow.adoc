= ARGUS: SeaGaP Workflow UX Specification
:author: ATLAS Project Team
:revdate: 2026-01-30
:toc:
:sectnums:

== Overview

SeaGaP-MP (Search, Gather, Process, Monitor, Post) defines the five-stage workflow for federated medical imaging in ARGUS. This document describes the **user experience** at each stage -- what the user sees, what actions are available, and how data flows between stages.

As of v4.4.0, the Search and Gather stages are **fused** into a single interactive flow. The user discovers datasets, browses their contents at file-level granularity, selects specific files and directories, and accumulates gathered data across multiple datasets -- all without leaving the Search stage. The traditional Gather stage (a separate review screen) is superseded by this inline gathering model.

== The Three Modes of Search

The Search stage supports three distinct user intents, all served by the same UI:

[cols="1,3,2"]
|===
| Mode | Intent | Entry Point

| **Work on existing project**
| Open a previously-saved project and enter the workspace IDE
| Click a project chip in the project strip, then click again to open detail, then OPEN

| **Search for new data**
| Discover and browse datasets for a new project
| Type a query in the AI Core, browse dataset tiles

| **Add data to existing project**
| Gather additional datasets into an existing project's data tree
| Click a project chip to set it as the gather target (highlighted), then search and gather datasets
|===

== The Project Strip

A persistent horizontal strip at the top of the Search stage displays all user projects as compact **project chips**. This strip never disappears during search or dataset browsing.

=== Visual Design

The strip is a scrollable flex row with a "PROJECTS" header label followed by one chip per project:

----
PROJECTS  [PNEUMONIA-STUDY-V1  2DS]  [BRAIN-TUMOR-SEG  1DS]  [+ NEW]
----

* **Default state**: honey-colored border and text on dark background.
* **Active state** (gather target): solid honey background with black text and glow. Indicates that gathered data will merge into this project.
* **"+ NEW" chip**: dashed border, harvestgold color. Clears the active target -- gathered data will create a new project.

=== Interaction

* **First click** on a project chip sets it as the **gather target** (highlighted). Terminal confirms: "GATHER TARGET: [PROJECT NAME]".
* **Second click** (chip already active) opens the project detail overlay (same as before -- FileBrowser with SOURCE/DATA tabs, OPEN button for workspace).
* Clicking a different chip switches the gather target.
* Clicking "+ NEW" clears the gather target.

== Dataset Discovery

When the user enters a search query (via AI Core or legacy filters), dataset tiles appear below the project strip. Each dataset is rendered as an `AssetCard` with:

* **Badge**: Modality and annotation type (e.g., "XRAY - CLASSIFICATION")
* **Meta**: Provider, image count, size
* **Cost**: Per-dataset cost in the badge area
* **Action pill**: "BROWSE" (default) or "GATHERED" (after selection)

Clicking a dataset tile opens the **Dataset Detail Overlay**.

== Dataset Detail: The Gather Interface

The dataset detail overlay reuses the shared `#asset-detail-overlay` DOM element (same as Marketplace and Project detail views), but populated for gathering:

=== Layout

* **LCARS Frame**: Hue 200 (sky blue, the dataset color family)
* **Sidebar**: Single "DATA" tab (datasets have no source code)
* **Content**: A `FileBrowser` in **selectable mode** showing the dataset's file tree
* **Cost strip**: Real-time tally of selected files and estimated cost
* **Command column**: Three pills -- DONE, ADDITIONAL DATA, CANCEL

=== Selectable FileBrowser

The FileBrowser component operates in selectable mode (`selectable: true`). Interactions:

[cols="1,3"]
|===
| Action | Effect

| **Short click** on a file
| Opens file preview in the preview pane (standard behavior)

| **Long press** (500ms+) on a file
| Toggles file selection. Selected files show a canary checkmark and left-border highlight.

| **Long press** on a folder
| Toggles selection of the folder and **all descendant files**. If all are selected, deselects all. If some or none are selected, selects all.
|===

Selected items receive the `.selected-for-gather` CSS class, which adds:
* A canary-colored left border (3px solid)
* A subtle background tint
* A checkmark (✓) prefix on file names

=== Cost Model

Cost per file is calculated as:

----
costPerFile = dataset.cost / totalFileCount
selectionCost = selectedFileCount * costPerFile
----

The cost strip updates live as selections change:

----
SELECTED: 45 / 293 FILES  |  ESTIMATED COST: $6.92
----

== The Gather Cycle

=== Committing a Selection

**DONE pill**: Commits the current selection and closes the overlay.

1. The selected file paths are extracted from the FileBrowser.
2. A **pruned subtree** is built: the directory skeleton is preserved, but only selected files are kept.
3. The subtree is stored in the `gatheredDatasets` map, keyed by dataset ID.
4. If a gather target project is active, the subtree is mounted into the project's VFS `/data` tree.
5. The dataset tile in the grid receives the `.gathered` class (visual tint + "GATHERED" badge).
6. Terminal confirms the gather with file count.

**ADDITIONAL DATA pill**: Same as DONE, but signals the user's intent to continue gathering from other datasets. The overlay closes, the gathered tile is marked, and the user returns to the search grid.

**CANCEL pill**: Closes the overlay without committing any selection.

=== Accumulation

Multiple datasets can be gathered in sequence. Each DONE or ADDITIONAL DATA action adds to the `gatheredDatasets` map. The accumulated data merges additively into the target project's `/data` tree -- each dataset contributes its own subdirectory.

=== Visual Feedback

Gathered dataset tiles in the search grid show:

* Reduced opacity (0.85)
* Harvestgold border color and subtle glow
* A "GATHERED" badge in the top-right corner
* The action pill text changes to "GATHERED" (inactive state)

== Data Flow: Search to Process

Once the user has gathered data from one or more datasets:

1. If a project chip is the gather target, the project's VFS `/data` tree now contains the gathered subtrees.
2. The user clicks the active project chip again to open the project detail.
3. From the project detail, clicking OPEN enters the workspace (terminal + FileBrowser split-pane).
4. The FileBrowser's DATA tab shows the merged gathered data.
5. The terminal is mounted at the project root with access to both `/src` and `/data`.
6. The user proceeds to write code, configure training, and federalize.

If no project was the gather target ("+ NEW" mode), the gathered data is stashed and can be associated with a new project when one is created.

== Stage Summary

[cols="1,2,3"]
|===
| Stage | Status | Notes

| **Search**
| Active — fused with Gather
| Project strip, dataset discovery, inline file-level gathering

| **Gather**
| Superseded
| Legacy stage still exists in code but the inline gather model replaces its UX role

| **Process**
| Active
| Workspace IDE with terminal + FileBrowser split-pane, FEDERALIZE AND LAUNCH

| **Monitor**
| Active
| Real-time training telemetry, loss charts, node status

| **Post**
| Active
| Model publication to Marketplace
|===

---
_Last updated: 2026-01-30 (v4.4.0)_
