= ARGUS Developer Notes
:author: ATLAS Project Team
:revdate: 2026-01-25
:toc:
:toclevels: 3

== LCARS UI Refactoring: Lessons Learned

This document captures the lessons learned during the LCARS UI refactoring of ARGUS v0.2.0. It serves as a reference for future developers (human or AI agent) to understand the correct approach to implementing LCARS-style interfaces.

=== The Problem: Initial Implementation Was Wrong

The initial ARGUS UI implementation attempted to create an "LCARS-inspired" interface from scratch without properly referencing the established LCARS Lower Decks theme. This resulted in:

* Incorrect panel structure (missing the stacked colored panel divs)
* Missing black borders between bars and panels
* Incorrect bar width proportions
* Missing corner elbow effects (60x60px gradient-based pseudo-elements)
* Navigation buttons that didn't match the LCARS pill-button aesthetic
* Overall layout that felt "off" compared to authentic LCARS

=== The Solution: Use the Reference Implementation

The slidedown project contains a complete, working LCARS Lower Decks theme implementation at:

----
/home/rudolphpienaar/src/slidedown/themes/lcars-lower-decks/
├── templates/lcars-frame.html   # Reference HTML structure
└── theme.css                    # Complete LCARS CSS (~2100 lines)
----

This is the authoritative reference by Jim Robertus (www.thelcars.com) and should be used as the template for any LCARS UI work.

=== Critical LCARS Structure Requirements

==== HTML Structure

The correct LCARS layout uses a specific nested structure:

[source,html]
----
<section class="wrap-all">
    <!-- TOP SECTION -->
    <div class="wrap">
        <div class="left-frame-top">
            <div class="panel-1">...</div>
            <div class="panel-2">...</div>
        </div>
        <div class="right-frame-top">
            <div class="banner">TITLE</div>
            <div class="bar-panel first-bar-panel">
                <div class="bar-1"></div>
                <div class="bar-2"></div>
                <div class="bar-3"></div>
                <div class="bar-4"></div>
                <div class="bar-5"></div>
            </div>
        </div>
    </div>

    <!-- BOTTOM SECTION (with gap) -->
    <div class="wrap" id="gap">
        <div class="left-frame">
            <div class="panel-3">...</div>
            <div class="panel-4">...</div>
            <div class="panel-5">...</div>
            <div class="panel-6">...</div>
            <div class="panel-7">...</div>
        </div>
        <div class="right-frame">
            <div class="bar-panel">
                <div class="bar-6"></div>
                <div class="bar-7"></div>
                <div class="bar-8"></div>
                <div class="bar-9"></div>
                <div class="bar-10"></div>
            </div>
            <main id="main-content">...</main>
        </div>
    </div>
</section>
----

==== CSS Variables

Essential CSS custom properties that must be defined:

[source,css]
----
:root {
    /* Frame dimensions */
    --lfw: 240px;                    /* Left frame width */
    --bar-height: 28px;              /* Height of bar panels */

    /* Bar widths (must total ~100% with flex on bar-4/bar-9) */
    --bar-1-6-width: 10%;
    --bar-2-7-width: 12%;
    --bar-3-8-width: 17%;
    --bar-5-10-width: 5%;

    /* Critical: Black borders between elements */
    --panel-border: .4rem solid black;
    --bar-border: .4rem solid black;

    /* Cut-out notch dimensions */
    --bar-cut-width: 32%;
    --bar-cut-out-width: 40%;

    /* LCARS Colors (Lower Decks palette) */
    --african-violet: #b48cc8;
    --mars: #d38c8b;
    --tamarillo: #a93734;
    --ice-cold: #a3f4f7;
    --sundown: #f4b4c0;
    --harvestgold: #d4a454;
    --almond-frost: #a08484;
    --butterscotch: #d49448;
}
----

==== Bar Cut-out Notches

Bars 4 and 9 require pseudo-elements to create the characteristic LCARS cut-out corners:

[source,css]
----
.bar-4::after,
.bar-9::after {
    content: "";
    width: var(--bar-cut-width);
    height: 48%;
    background-color: black;
    border-radius: 0 8px 0 0;
    position: absolute;
    left: 0;
    bottom: 0;
}
----

==== Corner Elbows

The curved corners on the left frame require gradient-based pseudo-elements:

[source,css]
----
.left-frame-top::after,
.left-frame::before {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background: radial-gradient(
        circle at 0% 0%,
        transparent 55px,
        var(--elbow-color) 55px,
        var(--elbow-color) 60px,
        transparent 60px
    );
}
----

=== TypeScript/JavaScript Coordination

When the HTML structure changes, the TypeScript must be updated to match:

|===
| HTML Change | TypeScript Update Required

| `.persona-pill` -> `.persona-btn`
| Update all `querySelectorAll('.persona-pill')` calls

| `.stage-btn` -> `.stage-indicator`
| Update stage navigation selectors and event handlers

| New elements (e.g., toggle button)
| Add handler functions and expose to window
|===

==== Exposing Functions to Window

For `onclick` handlers in HTML, functions must be exposed to the window object:

[source,typescript]
----
(window as unknown as Record<string, unknown>).functionName = functionName;
----

=== File Mapping: ARGUS to LCARS Reference

|===
| ARGUS File | Reference Source | Purpose

| `dist/index.html`
| `slidedown/.../lcars-frame.html`
| HTML structure template

| `dist/css/lcars.css`
| `slidedown/.../theme.css`
| Complete LCARS styling

| `src/argus.ts`
| N/A (ARGUS-specific)
| Application logic
|===

=== Debugging LCARS Layout Issues

If the LCARS layout looks wrong:

1. **Compare against reference screenshot** - Keep `tmp/lcars.png` as the visual target
2. **Check bar borders** - Every bar except bar-4, bar-5, bar-9, bar-10 needs `border-right: var(--bar-border)`
3. **Verify panel borders** - Panels need `border-bottom: var(--panel-border)`
4. **Check cut-out pseudo-elements** - bar-4 and bar-9 need `::after` elements with black background
5. **Verify corner elbows** - Check `::before` and `::after` on `.left-frame-top` and `.left-frame`
6. **Check flex settings** - bar-4 and bar-9 should be `flex: 1` to fill remaining space

=== Build and Test Commands

[source,bash]
----
# Full rebuild
make argus

# Quick build (TypeScript only)
make build

# Development server
make serve

# Watch mode (auto-rebuild on changes)
make watch
----

== Top Frame Redesign: SeaGaP Tracker (v1.2.0)

=== Design Goals

The top frame was redesigned to provide better workflow visualization using a "subway stop" metaphor for the SeaGaP-MP workflow stages: SEARCH, GATHER, PROCESS, MONITOR, POST.

==== Visual Design

* **Subway stations**: 5 stations span horizontally across the top panel
* **Connecting lines**: Dashed lines connect stations, showing the workflow path
* **Active station**: Expands with a telemetry window, fully opaque
* **Inactive stations**: Shrink and dim (opacity: 0.3)
* **Visited stations**: Clickable for back-navigation, slightly dimmed
* **ARGUS banner**: Positioned on far right with pill buttons (LOGOUT, NEXT) underneath

==== HTML Structure

[source,html]
----
<div class="content-top" id="content-top">
    <!-- SeaGaP Tracker with Telemetry Windows -->
    <div class="seagap-panel" id="seagap-panel">
        <div class="seagap-stations">
            <div class="station" id="station-search" data-stage="search">
                <div class="station-header" onclick="station_click('search')">
                    <div class="station-circle"></div>
                    <div class="station-label">SEARCH</div>
                </div>
                <div class="station-telemetry" id="tele-search">
                    <div class="tele-content monospace">...</div>
                </div>
            </div>
            <!-- Additional stations: gather, process, monitor, post -->
        </div>
    </div>
    <!-- ARGUS Banner and Pills -->
    <div class="argus-column">
        <div class="banner">ARGUS</div>
        <div class="pill-stack">
            <button class="pill-btn logout-pill">LOGOUT</button>
            <button class="pill-btn next-pill" id="btn-next">NEXT</button>
        </div>
    </div>
    <!-- Bar panel at bottom -->
    <div class="bar-panel first-bar-panel">...</div>
</div>
----

==== TypeScript Functions (RPN Naming)

[source,typescript]
----
// Track visited stages for back-navigation
const visitedStages: Set<string> = new Set();
const STAGE_ORDER: readonly string[] = ['search', 'gather', 'process', 'monitor', 'post'];

// Update station visual states
function stations_update(currentStage: AppState['currentStage']): void

// Handle click on visited station (back-navigation)
function station_click(stageName: string): void

// Advance to next stage in sequence
function stage_next(): void

// Update telemetry content with scrolling ticker
function stationTelemetry_update(stageName: AppState['currentStage']): void
----

=== Elbow Curve Fix: Stacking Context Issue

==== The Problem

When restructuring the top panel, the elbow curve (diagonal corner connecting left frame to content area) disappeared. Multiple attempts to fix using pseudo-elements with `z-index: -1` failed.

==== Root Cause

The `z-index: -1` pseudo-elements were being placed behind the `body` element's black background. This happened because:

1. The original `.right-frame-top` didn't use `display: flex`
2. The new `.content-top` used `display: flex` which changed the stacking context behavior
3. Without an explicit stacking context, `z-index: -1` elements go behind all ancestors

==== The Solution

Add `isolation: isolate` to create a new stacking context:

[source,css]
----
.content-top {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    align-content: flex-end;
    position: relative;
    max-width: calc(100% - var(--lfw));
    isolation: isolate; /* CRITICAL: Contains z-index:-1 pseudo-elements */
}

.content-top::before {
    content: '';
    width: 60px;
    height: 60px;
    background: linear-gradient(to top right, var(--corner-color-top) 50%, black 50%);
    position: absolute;
    left: 0;
    bottom: var(--bar-height);
    z-index: -1;
}

.content-top::after {
    content: '';
    width: 60px;
    height: 60px;
    background-color: black;
    border-radius: var(--radius-content-top); /* 0 0 0 44px */
    position: absolute;
    left: 0;
    bottom: var(--bar-height);
    z-index: -1;
}
----

==== Key Lesson

When using `z-index: -1` for pseudo-elements that should appear behind content but still be visible, ensure the parent element creates its own stacking context using one of:

* `isolation: isolate` (preferred - explicit and purpose-built)
* `transform: translateZ(0)`
* `opacity` less than 1
* `position: relative` with explicit `z-index`

=== Version History

|===
| Version | Date | Changes

| 0.1.0
| 2026-01-23
| Initial prototype (incorrect LCARS styling)

| 0.2.0
| 2026-01-24
| Complete LCARS UI refactoring based on slidedown reference

| 1.0.0
| 2026-01-24
| First stable release with complete SeaGaP workflow

| 1.1.0
| 2026-01-25
| SeaGaP tracker navigation improvements

| 1.2.0
| 2026-01-25
| Top frame redesign with subway-stop SeaGaP tracker, telemetry windows, elbow curve fix
|===
