= ARGUS Developer Notes
:author: ATLAS Project Team
:revdate: 2026-01-29
:toc:
:toclevels: 3

== LCARS UI Refactoring: Lessons Learned

This document captures the lessons learned during the LCARS UI refactoring of ARGUS v0.2.0. It serves as a reference for future developers (human or AI agent) to understand the correct approach to implementing LCARS-style interfaces.

=== The Problem: Initial Implementation Was Wrong

The initial ARGUS UI implementation attempted to create an "LCARS-inspired" interface from scratch without properly referencing the established LCARS Lower Decks theme. This resulted in:

* Incorrect panel structure (missing the stacked colored panel divs)
* Missing black borders between bars and panels
* Incorrect bar width proportions
* Missing corner elbow effects (60x60px gradient-based pseudo-elements)
* Navigation buttons that didn't match the LCARS pill-button aesthetic
* Overall layout that felt "off" compared to authentic LCARS

=== The Solution: Use the Reference Implementation

The slidedown project contains a complete, working LCARS Lower Decks theme implementation at:

----
/home/rudolphpienaar/src/slidedown/themes/lcars-lower-decks/
├── templates/lcars-frame.html   # Reference HTML structure
└── theme.css                    # Complete LCARS CSS (~2100 lines)
----

This is the authoritative reference by Jim Robertus (www.thelcars.com) and should be used as the template for any LCARS UI work.

=== Critical LCARS Structure Requirements

==== HTML Structure

The correct LCARS layout uses a specific nested structure:

[source,html]
----
<section class="wrap-all">
    <!-- TOP SECTION -->
    <div class="wrap">
        <div class="left-frame-top">
            <div class="panel-1">...</div>
            <div class="panel-2">...</div>
        </div>
        <div class="right-frame-top">
            <div class="banner">TITLE</div>
            <div class="bar-panel first-bar-panel">
                <div class="bar-1"></div>
                <div class="bar-2"></div>
                <div class="bar-3"></div>
                <div class="bar-4"></div>
                <div class="bar-5"></div>
            </div>
        </div>
    </div>

    <!-- BOTTOM SECTION (with gap) -->
    <div class="wrap" id="gap">
        <div class="left-frame">
            <div class="panel-3">...</div>
            <div class="panel-4">...</div>
            <div class="panel-5">...</div>
            <div class="panel-6">...</div>
            <div class="panel-7">...</div>
        </div>
        <div class="right-frame">
            <div class="bar-panel">
                <div class="bar-6"></div>
                <div class="bar-7"></div>
                <div class="bar-8"></div>
                <div class="bar-9"></div>
                <div class="bar-10"></div>
            </div>
            <main id="main-content">...</main>
        </div>
    </div>
</section>
----

==== CSS Variables

Essential CSS custom properties that must be defined:

[source,css]
----
:root {
    /* Frame dimensions */
    --lfw: 240px;                    /* Left frame width */
    --bar-height: 28px;              /* Height of bar panels */

    /* Bar widths (must total ~100% with flex on bar-4/bar-9) */
    --bar-1-6-width: 10%;
    --bar-2-7-width: 12%;
    --bar-3-8-width: 17%;
    --bar-5-10-width: 5%;

    /* Critical: Black borders between elements */
    --panel-border: .4rem solid black;
    --bar-border: .4rem solid black;

    /* Cut-out notch dimensions */
    --bar-cut-width: 32%;
    --bar-cut-out-width: 40%;

    /* LCARS Colors (Lower Decks palette) */
    --african-violet: #b48cc8;
    --mars: #d38c8b;
    --tamarillo: #a93734;
    --ice-cold: #a3f4f7;
    --sundown: #f4b4c0;
    --harvestgold: #d4a454;
    --almond-frost: #a08484;
    --butterscotch: #d49448;
}
----

==== Bar Cut-out Notches

Bars 4 and 9 require pseudo-elements to create the characteristic LCARS cut-out corners:

[source,css]
----
.bar-4::after,
.bar-9::after {
    content: "";
    width: var(--bar-cut-width);
    height: 48%;
    background-color: black;
    border-radius: 0 8px 0 0;
    position: absolute;
    left: 0;
    bottom: 0;
}
----

==== Corner Elbows

The curved corners on the left frame require gradient-based pseudo-elements:

[source,css]
----
.left-frame-top::after,
.left-frame::before {
    content: "";
    position: absolute;
    width: 60px;
    height: 60px;
    background: radial-gradient(
        circle at 0% 0%,
        transparent 55px,
        var(--elbow-color) 55px,
        var(--elbow-color) 60px,
        transparent 60px
    );
}
----

=== TypeScript/JavaScript Coordination

When the HTML structure changes, the TypeScript must be updated to match:

|===
| HTML Change | TypeScript Update Required

| `.persona-pill` -> `.persona-btn`
| Update all `querySelectorAll('.persona-pill')` calls

| `.stage-btn` -> `.stage-indicator`
| Update stage navigation selectors and event handlers

| New elements (e.g., toggle button)
| Add handler functions and expose to window
|===

==== Exposing Functions to Window

For `onclick` handlers in HTML, functions must be exposed to the window object using typed `declare global` extensions:

[source,typescript]
----
// In the module that defines the functions:
declare global {
    interface Window {
        myFunction: typeof myFunction;
    }
}

// Assign to window (type-safe, no 'any' cast):
window.myFunction = myFunction;
----

This pattern replaces the legacy `(window as any).functionName = functionName` approach. All modules that expose window bindings now use typed Window interface extensions: `argus.ts`, `marketplace/view.ts`, `ui/components/LCARSFrame.ts`.

=== File Mapping: ARGUS to LCARS Reference

|===
| ARGUS File | Reference Source | Purpose

| `dist/index.html`
| `slidedown/.../lcars-frame.html`
| HTML structure template

| `dist/css/lcars.css`
| `slidedown/.../theme.css`
| Complete LCARS styling

| `src/argus.ts`
| N/A (ARGUS-specific)
| Application entry point and orchestration
|===

=== Debugging LCARS Layout Issues

If the LCARS layout looks wrong:

1. **Compare against reference screenshot** - Keep `tmp/lcars.png` as the visual target
2. **Check bar borders** - Every bar except bar-4, bar-5, bar-9, bar-10 needs `border-right: var(--bar-border)`
3. **Verify panel borders** - Panels need `border-bottom: var(--panel-border)`
4. **Check cut-out pseudo-elements** - bar-4 and bar-9 need `::after` elements with black background
5. **Verify corner elbows** - Check `::before` and `::after` on `.left-frame-top` and `.left-frame`
6. **Check flex settings** - bar-4 and bar-9 should be `flex: 1` to fill remaining space

=== Build and Test Commands

[source,bash]
----
# Full rebuild
make argus

# Quick build (TypeScript only)
make build

# Development server
make serve

# Watch mode (auto-rebuild on changes)
make watch

# Run all tests
npm run test
----

== Top Frame Redesign: SeaGaP Tracker (v1.2.0 - v1.3.0)

=== Design Evolution: From Accordion to "Hanging Subway"

The initial top frame design used a horizontal accordion. While functional, it lacked the "command center" feel of LCARS. The design evolved into a "Hanging Subway" layout:

* **Top-Aligned Stations:** The station circles are anchored to the top of the panel, creating a persistent, straight "subway line" that never jumps.
* **Hanging Telemetry:** Instead of expanding sideways, telemetry windows "hang" down from the active station.
* **Multi-Window Display:**
    * **Active Station:** Large, detailed window with real-time stats.
    * **Visited Stations:** Compact, dimmed windows to the left, showing summary stats.
* **Global Ticker:** A single heartbeat loop updates all visible telemetry windows simultaneously, creating a busy, living dashboard effect.

==== CSS Implementation Details

[source,css]
----
.seagap-stations {
    align-items: flex-start; /* Anchors circles to top */
}

/* Reaching Connector Lines */
.station-line {
    margin-left: -55px;  /* Negative margins bridge the gap */
    margin-right: -55px; /* between wide station containers */
}

/* Hanging Window Effect */
.station-telemetry {
    border-top: none; /* Seamless connection to station */
    border-radius: 0 0 12px 12px;
}
----

== Testing Strategy

=== Framework

Vitest — chosen for native ESM/TypeScript support and speed.

=== Test Suites

[cols="2,1,3"]
|===
| Suite | Tests | Scope

| `src/vfs/VirtualFileSystem.test.ts`
| 64
| Path resolution, CWD, directory/file CRUD, node read/write/copy/move/remove, mount/unmount, lazy content generation, invalidation, event emission.

| `src/vfs/Shell.test.ts`
| 51
| Environment variables, prompt generation with ~ substitution, command parsing, all 15 builtins (cd, pwd, ls, cat, mkdir, touch, rm, cp, mv, echo, env, export, whoami, date, history, help), stage transitions, external handler delegation.

| `src/vfs/content/ContentRegistry.test.ts`
| 16
| Generator registration, path resolution, VFS integration (lazy generation + caching), all 8 core template generators.

| `src/core/logic/costs.test.ts`
| 3
| Cost estimation engine.

| **Total**
| **134**
|
|===

[source,bash]
----
# Run all tests
npm run test

# Run specific suite
npx vitest run src/vfs/Shell.test.ts
----

== Version History

|===
| Version | Date | Changes

| 0.1.0
| 2026-01-23
| Initial prototype (incorrect LCARS styling)

| 0.2.0
| 2026-01-24
| Complete LCARS UI refactoring based on slidedown reference

| 1.0.0
| 2026-01-24
| First stable release with complete SeaGaP workflow

| 1.1.0
| 2026-01-25
| SeaGaP tracker navigation improvements

| 1.2.0
| 2026-01-25
| Top frame redesign with subway-stop SeaGaP tracker, telemetry windows, elbow curve fix

| 1.3.0
| 2026-01-25
| "Hanging Subway" layout, multi-window telemetry, Monitor stage fix, Vitest integration

| 3.0.0
| 2026-01-26
| "The Federalization Update" — Pub/Sub architecture, Store + EventBus, `federate` command, full modularization

| 3.1.0
| 2026-01-26
| "The Marketplace Update" — 400+ assets, category filtering, VFS integration

| 3.2.1
| 2026-01-26
| "The Telemetry Restore" — Fixed telemetry regression, unified registry-based service

| 3.3.0
| 2026-01-28
| "The Modularization Update" — Decoupled `lcars-framework`, procedural WorkflowTracker

| 3.4.0
| 2026-01-28
| "The Visual Language Update" — Frame Slot system, Beckon Pulse, SlidePanel

| 3.4.1
| 2026-01-29
| "The VCS Update" — Complete Virtual Computer System: VirtualFileSystem, Shell (15 builtins), ContentRegistry (14 generators), 3 Providers, and a broad automated test suite

| 3.5.0
| 2026-01-29
| "The Style Sweep" — Comprehensive code audit: eliminated `any` from core, RPN-renamed 20+ functions, JSDoc on 50+ functions, decomposed long methods, typed all lambdas/params, `declare global` Window extensions
|===
