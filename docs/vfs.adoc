= Virtual File System: Deterministic Substrate for Provenance
:author: ATLAS Project Team
:revdate: 2026-02-20
:revnumber: 10.3.0
:toc: macro
:toclevels: 4
:sectnums:

toc::[]

== Abstract

The ARGUS Virtual File System is the substrate where workflow truth is
materialized. It provides a POSIX-like node model, deterministic mutation
semantics, and event surfaces used by orchestration and rendering layers. In the
state-grounded model, workflow completion is not an in-memory assertion; it is a
filesystem fact anchored by Merkle lineage.

This document specifies the VFS as an integrity component rather than a utility
layer.

== Historical Context

Legacy workflow implementations tracked progress in process memory and UI state. As
workflow complexity increased, those representations drifted from actual side
effects. The response was to move state authority onto a file-backed model where
every meaningful transition could be inspected, replayed, and cryptographically
anchored.

The VFS was introduced to make this possible in headless and test environments
without requiring immediate dependence on a specific host filesystem backend.

== VFS Mutation Figure

[source,text]
----
┌──────────────────────────┐
│ PATH + OPERATION         │
│ read/write/move/link     │
└────────────┬─────────────┘
             ▼
┌──────────────────────────┐
│ PATH RESOLUTION          │
│ abs / home / relative    │
└────────────┬─────────────┘
             ▼
┌──────────────────────────┐
│ NODE MUTATION            │
│ POSIX metadata update    │
└────────────┬─────────────┘
             ▼
┌──────────────────────────┐
│ VFS_CHANGED EVENT        │
└───────┬──────────┬───────┘
        │          │
        ▼          ▼
┌──────────────┐  ┌──────────────┐
│ UI SYNC      │  │ MERKLE CHECK │
└──────────────┘  └──────────────┘
----

== Node and Path Semantics

The VFS stores directories, files, and links as typed nodes with ownership,
permission, and timestamp metadata. Path resolution follows POSIX semantics across
absolute, home-relative, and process-relative forms, and each shell process
maintains its own working-directory context. This allows command behavior to remain
predictable across concurrent sessions and adapters.

Symbolic-link behavior is used to present stable working surfaces such as `input`
while preserving lineage structure inside project data trees.

[source,text]
----
/home/user/projects/my-study/
├── src/                    (mutable workshop)
├── input -> data/...       (active portal symlink)
└── data/                   (lineage vault)
    └── search/
        └── gather/
            └── harmonize/
----

== Mutation and Event Contract

Mutations are executed through deterministic operations that either succeed
atomically or fail with explicit errors. Successful writes emit VFS change events
consumed by both interface adapters and provenance layers. This shared event stream
ensures that render updates and lineage checks observe the same underlying state
transition.

The key invariant is temporal coherence: what adapters display and what Merkle
layers anchor are both projections of the same mutation history.

== Lazy Content Materialization

To avoid unnecessary memory cost for scaffolded or generated assets, nodes may be
initialized with generator identities. Content is synthesized on read and frozen
into static snapshots once manually edited. This preserves developer ergonomics
while maintaining stable provenance after human intervention.

== Architectural Outcome

The VFS is the operational ledger of ARGUS. It enables deterministic command
execution, supports adapter parity through shared event semantics, and provides the
physical basis on which Merkle lineage can prove workflow integrity. As backend
storage evolves, this contract remains the reference behavior for state truth.

---
_Last updated: 2026-02-20 (v10.3.0)_
