= ARGUS v10 Refactor Specification: Host/Guest Contract Formation
:author: ARGUS Collaborative Development
:revdate: 2026-02-20
:revnumber: 10.3.0
:toc: macro
:toclevels: 3
:sectnums:

toc::[]

== Abstract

This specification records the v10 refactor as an architectural separation event
rather than a feature increment. The pre-v10 system still contained
workflow-specific assumptions inside core orchestration paths, which created
coupling between persona evolution and kernel stability. The v10 program resolves
that coupling by establishing a formal Host/Guest boundary: Calypso operates as a
deterministic integrity kernel, while domain compute is executed as unprivileged
plugins selected by manifest contracts.

The same transition also redefined intent handling as protocol compilation and
verification, replacing legacy waterfall dispatch with a constrained
interpretation-first pipeline. The key result is that natural language remains a
control surface, but state mutation authority remains in deterministic,
verifiable runtime layers.

== Historical Pressure

Before v10, introducing or modifying workflow behavior required touching core
dispatch logic. That made correctness fragile because unrelated stage changes could
alter global execution behavior. Verification effort also drifted toward
conversation matching because protocol semantics were mixed with narrative output.
As workflows became more branched and provenance-sensitive, this model could no
longer defend reproducibility claims.

The refactor objective was therefore to align architecture with scientific
requirements: command interpretation may be probabilistic, but command execution
and state transitions must be deterministic and materialized.

== Refactor Shift Figure

[source,text]
----
v9 monolithic dispatch:

┌────────────────────────────────────────────────────┐
│ CORE ORCHESTRATOR                                  │
│ intent + workflow logic + compute + state writes   │
└────────────────────────────────────────────────────┘

v10 host/guest contract:

┌────────────────┐   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐
│ INTENT PARSE   │──▶│ DAG VALIDATE   │──▶│ PLUGIN EXECUTE │──▶│ MERKLE WRITE   │
└────────────────┘   └────────────────┘   └────────────────┘   └────────────────┘
      (HOST)               (HOST)                (GUEST)              (HOST)
----

== Refactor Resolution

The v10 line introduced a five-layer runtime sequence that remains active in the
current codebase. User language is compiled into a canonical intent, validated
against active workflow topology, dispatched to a plugin selected by manifest
handler, and materialized by host-controlled Merkle anchoring. Graceful
degradation remains available when no model provider is configured, but that path
still uses the same deterministic execution contract for workflow commands.

The resulting protocol contract replaced binary success signaling with categorical
status outcomes, allowing machine-verifiable assertion against blocked, stale,
conversational, and successful branches.

== Runtime Contract Surface

The plugin boundary is now enforced through a typed context/result interface.
Plugins receive only project-scoped capabilities and return evidence payloads.
They do not own provenance writes, and they do not mutate kernel configuration.
The host captures plugin output, computes Merkle lineage, and materializes session
artifacts as the sole witness of completion.

[source,typescript]
----
interface PluginContext {
    vfs: VirtualFileSystem;
    shell: Shell;
    store: CalypsoStoreActions;
    parameters: Record<string, unknown>;
}

interface PluginResult {
    message: string;
    statusCode: CalypsoStatusCode;
    artifactData?: unknown;
}
----

This contract made it possible to externalize domain logic without sacrificing
execution rigor. It also established the basis for later hardening work in which
federation phases were materialized as individual plugins and backend simulation
paths were deleted.

== Verification Consequence: Oracle v2

Refactor completion required verification strategy change. Oracle scenarios moved
from conversational assertions to contractual walks that validate status outcomes
and artifact existence. That shift closed a major blind spot from pre-v10 tests:
a fluent response can no longer mask missing materialization.

== Architectural Outcome

The v10 refactor created the foundation for the subsequent hardening and deletion
releases. By relocating workflow compute into manifest-selected plugins and
restricting kernel responsibility to validation and provenance, ARGUS moved from a
monolithic orchestrator to a composable execution kernel. Later releases in the
10.2 and 10.3 line should be understood as contract purification of this same
design, not as a separate architectural direction.

---
_Last updated: 2026-02-20 (v10.3.0)_
