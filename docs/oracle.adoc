= ORACLE: State-First Reflexive Verification
:author: ATLAS Project Team
:revdate: 2026-02-17
:revnumber: 2.0.0
:toc: macro
:toclevels: 4
:sectnums:
:icons: font

[.lead]
_A methodology for verifying AI-mediated systems by asserting on materialized data-state transformations rather than natural language output._

toc::[]

== Abstract

ORACLE (Observational Reflexive Agentic Confirmation of Logical Execution) is the reflexive verification methodology of the ARGUS system. It addresses the fundamental challenge of testing AI-driven interfaces: the inherent non-determinism of natural language output. By utilizing the system's own conversational interface as the test driver and the internal system state as the verification oracle, ORACLE ensures that cognitive operations result in correct, verifiable data mutations. This document specifies the ORACLE v2.0 **State-First Verification** strategy, detailing the "Contractual Walk" protocol and the mechanics of artifact-based state proofs within the Virtual File System (VFS).

== Introduction: The Case for State-First Testing

=== The Problem: Surface Ambiguity
In the early development of ARGUS (v1.0 through v9.0), verification relied on "Conversational Matching"—the process of asserting that the AI's English response contained specific keywords (e.g., `expect(msg).toContain("successfully")`). This approach proved fundamentally brittle. Minor adjustments to the system's persona, subtle variations in LLM token prediction, or changes to the LCARS visual language (CSS) would trigger false-positive test failures, even when the underlying system logic was correct.

=== The Resolution: The Truth of State
We learned that for high-integrity scientific workflows, what an AI *says* is less important than what it *does*. The resolution was the implementation of **State-First Verification** in ORACLE v2.0. The methodology shifts the focus of testing from the "Surface Form" (the text) to the "Ground Truth" (the filesystem). In v2.0, a test is only considered successful if the system transitions to the correct logical state and materializes the required Merkle-proven artifacts in the VFS. This ensures that the system's logical state machine is verified independently of its linguistic posture.

== ORACLE Walk Figure

[source,text]
----
┌─────────────────────┐
│ send command        │
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│ receive response    │
│ (statusCode/actions)│
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│ assert statusCode   │
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│ assert materialized │
│ artifact paths      │
└──────────┬──────────┘
           ▼
┌─────────────────────┐
│ next step in walk   │
└──────────┬──────────┘
           └─────────────── loop until scenario complete
----

== The Methodology: The Contractual Walk

A "Contractual Walk" is a formal verification scenario that exercises a specific topological path through a workflow DAG. Unlike unit tests, a Walk is an end-to-end integration of the 4-stage pipeline.

=== Intent Resolution Verification
Each step in a Walk begins with a natural language command (e.g., "harmonize the cohort"). ORACLE verifies that the `IntentParser` correctly "compiles" this fuzzy input into the canonical protocol command defined in the manifest.

=== Protocol-First Assertions
The primary target for ORACLE assertions is the `CalypsoStatusCode`. This enum (defined in `src/lcarslm/types.ts`) represents the machine-verifiable outcome of an operation.
- **`OK`**: Confirms that prerequisites were met and the plugin executed successfully.
- **`BLOCKED_MISSING`**: Confirms that safety gates correctly prevent out-of-order execution.
- **`BLOCKED_STALE`**: Confirms that the system correctly detects Merkle-proven data drift.

=== Materialization Proofs (The Artifact Oracle)
The ultimate proof of work in ARGUS is the materialization of a physical artifact. Every successful step in a Walk must produce a JSON envelope at a topology-aware path. ORACLE performs recursive VFS existence checks to verify these proofs. A step is only verified if the Host returns an `OK` status *and* the artifact (e.g., `.../gather/harmonize/data/harmonize.json`) appears on the virtual disk.

== The ORACLE Runner: Automated Session Driver

The `oracle-runner.mjs` is an in-process driver designed to simulate a human operator interacting with the Calypso Host.

=== Automated Phase Jump Handling
Agentic workflows often involve "Phase Jumps"—attempts to skip non-essential stages. The ARGUS Host correctly blocks these jumps and requests confirmation. The ORACLE runner detects these `BLOCKED` responses and automatically injects the required `confirm` command. This verifies both the system's ability to detect jumps and its ability to maintain session continuity after confirmation.

=== Dynamic Variable Interpolation
To remain environment-agnostic, ORACLE test scripts use dynamic variables:
- **`${session}`**: Interpolates the unique, timestamped session path.
- **`${project}`**: Interpolates the active project name.
The runner re-fetches these paths from the system Store after every command, allowing a single script to verify persistence across project renames and system resets.

== Systematic Testing Scenarios

The ORACLE suite comprises specialized walks designed to stress the system's architectural limits:

*   **Linear Path Walks:** Verifies the "Golden Path" from discovery to publication.
*   **Branching Path Walks:** Verifies that optional stages (e.g., `rename`) correctly fork the session tree without breaking downstream logic.
*   **Stress Walks:** Intentionally executes steps out-of-order to verify the robustness of the DAG Engine's safety gates.
*   **Merkle Staleness Walks:** Modifies upstream artifacts to verify that the system correctly flags the entire downstream pipeline as stale.

== Conclusion

ORACLE v2.0 represents the formalization of "Reflexive Verification." By using the AI layer to test the deterministic system it controls, ARGUS ensures that its intelligence is always grounded in verifiable truth. The methodology provides the mathematical rigor required for national-scale medical research, transforming "Conversational AI" into a robust, auditable, and scientifically valid research instrument.

---
_Last updated: 2026-02-17 (v2.0.0)_
