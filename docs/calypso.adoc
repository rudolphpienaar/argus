= CALYPSO: Intelligence Kernel and Dispatch Integrity
:author: ATLAS Project Team
:revnumber: 10.3.1
:revdate: 2026-02-21
:toc: macro
:toclevels: 4
:sectnums:

toc::[]

== Abstract

CALYPSO is the execution kernel that mediates between human language and
deterministic workflow mutation in ARGUS. The kernel does not own domain compute.
It owns interpretation constraints, topological validation, plugin dispatch, and
artifact anchoring through Merkle materialization. This separation is the
mechanism that prevents conversational fluency from masquerading as scientific
completion.

The current version reflects post-hardening policy: backend layers remain
production-pure, federation behavior is plugin materialized, and workflow commands
are constrained to manifest-derived vocabulary.

== Historical Context

Earlier generations treated Calypso as a general assistant that both interpreted
intent and made action decisions. That model failed under multi-step protocols
because language confidence could drift away from state evidence. The v10 refactor
converted Calypso into a host kernel, and the 10.2 to 10.3 line hardened that
conversion by deleting residual internalized behavior.

The core lesson was structural: if intent compilation, execution permission, and
state materialization are not separated, provenance cannot be trusted in long
running scientific flows.

== Kernel Flow

[source,text]
----
                            ┌──────────────────────────┐
                            │        USER INPUT        │
                            └────────────┬─────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │       CALYPSO CORE       │
                            └────────────┬─────────────┘
                                         │
                  ┌──────────────────────┴──────────────────────┐
                  │                                             │
                  ▼                                             ▼
       ┌──────────────────────────┐                ┌──────────────────────────┐
       │ FAST-PATH DISPATCH       │                │ INTENT COMPILATION       │
       │ (/cmd + shell builtins)  │                │ (deterministic + model)  │
       └────────────┬─────────────┘                └────────────┬─────────────┘
                    │                                           │
                    └──────────────────────┬────────────────────┘
                                           │
                                           ▼
                            ┌──────────────────────────┐
                            │ WORKFLOW GATEKEEPER      │
                            │ topology + policy checks │
                            └────────────┬─────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ PLUGINHOST DISPATCH      │
                            └────────────┬─────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ MERKLE MATERIALIZER      │
                            └────────────┬─────────────┘
                                         │
                                         ▼
                            ┌──────────────────────────┐
                            │ PROTOCOL RESPONSE        │
                            │ status + actions + msg   │
                            └──────────────────────────┘
----

The fast path handles explicit kernel verbs and shell operations without involving
language synthesis. Non-fast-path input is compiled into typed intent. If
deterministic resolution is unavailable, model synthesis remains constrained by the
active manifest command set. Execution permission is decided only after topology
checks. Completion claims become valid only when artifact evidence is written.

If no model provider is available, conversational fallbacks are reported as offline
without backend simulation surrogates. Deterministic workflow and shell paths remain
operational.

== Response Contract

Calypso communicates through a categorical status protocol rather than boolean
success signaling.

[cols="1,3",options="header"]
|===
|Code |Meaning
|`OK` |Intent valid, prerequisites satisfied, and plugin execution anchored.
|`BLOCKED` |Intent recognized but blocked by workflow policy.
|`BLOCKED_MISSING` |Required parent evidence absent.
|`BLOCKED_STALE` |Parent lineage changed and descendant evidence is stale.
|`CONVERSATIONAL` |Input handled as non-mutating guidance.
|===

This contract allows adapters and verification runners to assert behavior
independently of narrative phrasing.

== Integrity Boundary

Plugins produce domain output; Calypso witnesses and records completion. The host
therefore owns Merkle anchoring and session-tree writes, while plugin code remains
unprivileged compute. This prevents guest logic from self-certifying completion and
preserves one authoritative provenance path.

Latency policy follows the same boundary. Backend components do not inject
synthetic compute sleep. Optional realism delay is plugin-local and can be
disabled for oracle throughput with `CALYPSO_FAST=true`.

Execution policy now follows the same doctrine: host runtime no longer applies a
fixed-duration plugin kill watchdog during workflow execution. A stage runs until
plugin completion or plugin failure, and any future cancellation semantics must be
explicitly modeled rather than encoded as hidden time limits inside kernel dispatch.

== Telemetry Rendering Contract

Telemetry event ownership is split by layer:

1. Plugins emit primitive events (`log`, `progress`, `phase_start`, `frame_open`,
   `frame_close`, `status`).
2. Host/server transport events without reinterpreting narrative content.
3. Surface adapters own rendering geometry.

For the CLI/TUI adapter, progress semantics are now stateful by design: one active
progress row is rewritten in place instead of appending one line per event. This
prevents the historical "progress triangle" artifact during long compute loops.
Progress bars render with glyph blocks (`█` and `░`) for fast visual scanning in
dense terminal sessions.

== Architectural Outcome

Calypso now operates as a deterministic integrity kernel with constrained language
compilation at the boundary and artifact proof at the core. This keeps interaction
natural for operators while maintaining strict scientific state semantics for every
mutation-bearing step in the workflow lifecycle.

---
_Last updated: 2026-02-21 (v10.3.1)_
