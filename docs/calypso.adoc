= CALYPSO: The AI Core
:revnumber: 9.0.0
:revdate: 2026-02-16
:toc: macro
:toclevels: 3
:sectnums:

toc::[]

== Identity

**Name:** CALYPSO
**Acronym:** **C**ognitive **A**lgorithms & **L**ogic **Y**ielding **P**redictive **S**cientific **O**utcomes
**Role:** The Intelligence Layer of the ARGUS System.

=== Namesake

CALYPSO carries a layered homage spanning Greek mythology and _Star Trek: Discovery_:

**The Myth (Homer's Odyssey):** Calypso was a nymph who lived on the island of Ogygia. When the shipwrecked Odysseus washed ashore, she rescued him and kept him on her island for seven years, offering immortality if he would stay. Her name derives from the Greek _kalyptō_ — "to conceal" or "to hide." Where the mythological Calypso concealed Odysseus _from_ the world, our CALYPSO conceals complexity _for_ the user.

**Daughter of ATLAS:** In the ARGUS system hierarchy, CALYPSO is the _daughter_ of ATLAS — born from the infrastructure. ATLAS (the titan, the platform) bears the weight of the federated learning ecosystem. CALYPSO, his daughter, is the intelligence that emerges from that foundation, guiding users through the complexity her father supports.

**Star Trek: Discovery — "Calypso" (Short Treks, 2018):** The name is a direct reference to the _Star Trek: Short Treks_ episode **"Calypso"**, which is part of the _Discovery_ storyline. In this episode, set a thousand years after _Discovery_'s final mission, a wounded soldier named Craft is rescued by **Zora** — the USS _Discovery_'s evolved artificial intelligence. Like the mythological nymph, Zora nurses Craft back to health, forms a bond with him, and ultimately helps him return home to his family. The _Discovery_ series finale (2024) revealed that Zora waited alone for a millennium, maintaining the ship in a nebula, to ensure this encounter would happen.

**The Double Homage:** ARGUS pays tribute to Star Trek twice over:

1. The entire visual language is **LCARS** — the Library Computer Access/Retrieval System designed by Michael Okuda for _The Next Generation_. This is the same interface paradigm that Zora would have used aboard _Discovery_.

2. The name "Calypso" directly invokes Zora's episode — an AI manifesting through LCARS, patiently guiding users through unfamiliar territory, concealing complexity so they can focus on their mission and eventually reach their destination. Like Zora, our CALYPSO is the daughter of her ship — born from the infrastructure, waiting to help.

== Lore & Function

CALYPSO is the "Ghost in the Machine" — the daughter of ATLAS, the artificial intelligence that bridges the gap between the human user and the massive, federated complexity of her father's network.

While ARGUS provides the guided framework (the body), CALYPSO provides the logic and natural language understanding (the mind). Born from the infrastructure, she is responsible for:

*   **Cohort Discovery:** Translating vague human intent ("Show me brain scans") into precise database queries.
*   **Context Management:** Remembering user session state, selected datasets, and project context.
*   **Workflow Guidance:** Suggesting the next logical steps in the SeaGaP (Search, Gather, Process) pipeline.
*   **Knowledge Retrieval:** She has read-access to the full system documentation (`docs/*.adoc`) and can explain architecture, file structures, and workflows on demand.

== Architecture: The Modular Core

As of v9.0.0, Calypso is architected as a **modular orchestrator** that delegates logic to specialized providers. This separation of concerns ensures that the core remains a thin, maintainable pipeline while presentation and heavy logic are isolated.

=== The Layer Model

[source]
----
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PRESENTATION LAYER                                │
│   (Environment-specific adapters)                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   BrowserAdapter          CLIAdapter            NodeAdapter                 │
│   ┌─────────────┐        ┌─────────────┐       ┌─────────────┐             │
│   │ Terminal UI │        │   stdout    │       │ Test Harness│             │
│   │ DOM updates │        │   readline  │       │ Assertions  │             │
│   └──────┬──────┘        └──────┬──────┘       └──────┬──────┘             │
│          │                      │                     │                     │
└──────────┼──────────────────────┼─────────────────────┼─────────────────────┘
           │                      │                     │
           └──────────────────────┼─────────────────────┘
                                  │
                    CalypsoResponse (actions + message)
                                  │
┌─────────────────────────────────┼───────────────────────────────────────────┐
│                                 ▼                                           │
│                         CALYPSO CORE (Orchestrator)                         │
│   (Thin pipeline, logic-free)                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   CalypsoCore.ts (Pipeline Stages)                                          │
│   1. Script Capture  4. Control Plane  7. Shell (Builtins)  10. Action Match│
│   2. Special Cmds    5. Confirmations  8. Workflow Dispatch 11. LLM Query  │
│   3. Script UX       6. Harmonize      9. Guidance                          │
│                                                                             │
├──────────┬──────────────────────┬─────────────────────┬─────────────────────┤
│          ▼                      ▼                     ▼                     │
│   LOGIC PROVIDERS        PRESENTATION          ROUTERS               UTILS  │
│   ┌──────────────┐      ┌──────────────┐      ┌──────────────┐      ┌─────┐ │
│   │ SearchProv   │      │ CalypsoPres  │      │ ControlPlane │      │ VFS │ │
│   │ StatusProv   │      │ (ANSI/Trek)  │      │ ActionRouter │      │ Snap│ │
│   │ LLMProv      │      └──────────────┘      └──────────────┘      └─────┘ │
│   └──────────────┘                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
----

=== CalypsoCore

The `CalypsoCore` class is the central pipeline orchestrator. It manages the flow of user input through a series of deterministic handlers before falling back to the LLM.

**Integration with Providers:**
Calypso delegates all complex logic to specialized providers:
1.  **SearchProvider**: Handles dataset discovery, anaphora resolution (`that`, `them`), and search snapshots.
2.  **StatusProvider**: Generates system status blocks, version info, and LLM context summaries.
3.  **LLMProvider**: Orchestrates LLM queries and processes responses via the `IntentParser`.
4.  **CalypsoPresenter**: Centralizes all visual formatting (ANSI decorators, LCARS markers `●/○`).

[source,typescript]
----
// src/lcarslm/CalypsoCore.ts

export class CalypsoCore {
    /** Primary command execution pipeline (11 stages). */
    public async command_execute(input: string): Promise<CalypsoResponse> {
        // 1. Check script capture
        // 2. Check special commands (/, snapshots, reset)
        // 3. Check script discovery
        // 4. Check control plane intents
        // 5. Check confirmation gates
        // 6. Check first-class harmonize
        // 7. Check shell builtins (delegated to ShellBuiltins)
        // 8. Check workflow dispatch (manifest-driven)
        // 9. Check guidance interrogatives
        // 10. Check imperative action matches
        // 11. Fall back to LLMProvider
    }
}
----

=== CalypsoResponse

Instead of directly manipulating the DOM, CalypsoCore returns a structured response. Adapters interpret the response according to their environment.

[source,typescript]
----
export interface CalypsoResponse {
    /** Text message to display */
    message: string;

    /** Actions for the adapter to execute */
    actions: CalypsoAction[];

    /** Whether the operation was successful */
    success: boolean;

    /** Optional state snapshot for verification */
    state?: {
        vfs?: VfsSnapshotNode;
        store?: Partial<AppState>;
    };
}
----

=== Logic Providers Reference

[cols="1,2,2"]
|===
| Provider | Responsibilities | Location

| `SearchProvider`
| Discovery, Anaphora, Snapshots
| `src/lcarslm/SearchProvider.ts`

| `StatusProvider`
| Status blocks, Version, Context
| `src/lcarslm/StatusProvider.ts`

| `LLMProvider`
| Query orchestration, Intent parsing
| `src/lcarslm/LLMProvider.ts`

| `CalypsoPresenter`
| ANSI formatting, Tables, Markers
| `src/lcarslm/CalypsoPresenter.ts`
|===

== Operating Modes

Calypso can run in three modes:

=== Browser Mode (Full ARGUS)

The traditional mode where Calypso runs inside the ARGUS web application.

[source,bash]
----
$ make serve
# Open http://localhost:8080
# Calypso is available in the Intelligence Console
----

=== Headless Mode (Standalone Server)

Calypso runs as a Node.js server without a browser. Useful for testing, scripting, and CLI interaction.

[source,bash]
----
$ make calypso
Starting Calypso Server on :8081...
CalypsoCore initialized (VFS: 47 nodes, Store: clean)
Ready for connections.
----

=== CLI Mode (Interactive REPL)

A command-line client connects to the headless server. The CLI provides an SSH-style login experience, dynamic prompt with username and working directory, a spinner during async operations, and markdown-to-ANSI rendering of LLM responses.

[source,bash]
----
$ make calypso-cli
╔══════════════════════════════════════════════════════════════╗
║  CALYPSO CORE V9.0.0                                         ║
║  Cognitive Algorithms & Logic Yielding Predictive Scientific ║
║  Outcomes                                                    ║
╚══════════════════════════════════════════════════════════════╝
Connected to localhost:8081
----

== Source Structure

As of v9.0.0, the Calypso service is organized into logic providers and routing modules:

[source]
----
src/lcarslm/                        # CalypsoCore — the AI brain
├── CalypsoCore.ts                  #   The Thin Orchestrator
├── CalypsoPresenter.ts             #   The Visual Language Layer
├── SearchProvider.ts               #   Discovery & Anaphora
├── StatusProvider.ts               #   System & Context Summaries
├── LLMProvider.ts                  #   LLM Query Orchestrator
├── engine.ts                       #   LCARSEngine: LLM client wrapper
├── types.ts                        #   CalypsoResponse, CalypsoAction, Intent
├── federation/
│   ├── FederationOrchestrator.ts   #   Workflow Handshake
│   └── FederationContentProvider.ts#   Artifact Generation
├── routing/
│   ├── ActionRouter.ts             #   Imperative Intent Routing
│   ├── ControlPlaneRouter.ts       #   Automation Intents
│   └── IntentParser.ts             #   LLM Result Parsing
├── utils/
│   └── VfsUtils.ts                 #   VFS Snapshotting & Serialization
└── scripts/
    └── ScriptRuntime.ts            #   .clpso script execution
----

NOTE: For the full service architecture specification, see `docs/calypso-architecture.adoc`.

== Integration with ORACLE

The modular architecture enables precise ORACLE testing. Tests can now assert on specific provider state (e.g., SearchProvider's anaphora buffer) or verify that the orchestrator routes to the correct deterministic handler before hitting the LLM.

---
_Last updated: 2026-02-16 (v9.0.0)_
