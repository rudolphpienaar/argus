const fs = require('fs');
const path = require('path');

const DOCS_DIR = path.join(__dirname, '../docs');
const OUTPUT_FILE = path.join(__dirname, '../src/core/data/knowledge.ts');

console.log('Bundling documentation for AI Knowledge Base...');

try {
    const files = fs.readdirSync(DOCS_DIR).filter(file => file.endsWith('.adoc'));
    const knowledge = {};

    files.forEach(file => {
        const content = fs.readFileSync(path.join(DOCS_DIR, file), 'utf-8');
        // Clean up content: remove excessive newlines, maybe header markers if needed
        // For now, keep raw text but trim.
        knowledge[file] = content.trim();
    });

    const outputContent = `/**
 * @file System Knowledge Base
 * Auto-generated by scripts/bundle-docs.cjs
 * Contains the full content of the docs/ directory for AI context.
 */

export const SYSTEM_KNOWLEDGE: Record<string, string> = ${JSON.stringify(knowledge, null, 4)};
`;

    fs.writeFileSync(OUTPUT_FILE, outputContent);
    console.log(`Successfully bundled ${files.length} documents into ${OUTPUT_FILE}`);

} catch (err) {
    console.error('Error bundling docs:', err);
    process.exit(1);
}
